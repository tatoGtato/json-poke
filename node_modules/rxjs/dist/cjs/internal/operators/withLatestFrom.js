"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.withLatestFrom = void 0;
const Observable_1 = require("../Observable");
const Subscriber_1 = require("../Subscriber");
const from_1 = require("../observable/from");
const identity_1 = require("../util/identity");
const noop_1 = require("../util/noop");
const args_1 = require("../util/args");
function withLatestFrom(...inputs) {
    const project = (0, args_1.popResultSelector)(inputs);
    return (source) => new Observable_1.Observable((destination) => {
        const len = inputs.length;
        const otherValues = new Array(len);
        let hasValue = inputs.map(() => false);
        let ready = false;
        for (let i = 0; i < len; i++) {
            (0, from_1.from)(inputs[i]).subscribe((0, Subscriber_1.operate)({
                destination,
                next: (value) => {
                    otherValues[i] = value;
                    if (!ready && !hasValue[i]) {
                        hasValue[i] = true;
                        (ready = hasValue.every(identity_1.identity)) && (hasValue = null);
                    }
                },
                complete: noop_1.noop,
            }));
        }
        source.subscribe((0, Subscriber_1.operate)({
            destination,
            next: (value) => {
                if (ready) {
                    const values = [value, ...otherValues];
                    destination.next(project ? project(...values) : values);
                }
            },
        }));
    });
}
exports.withLatestFrom = withLatestFrom;
//# sourceMappingURL=withLatestFrom.js.map